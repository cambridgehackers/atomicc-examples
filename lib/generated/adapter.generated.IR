STRUCT NOCDataH  {
    FILE atomicc_OC_h
    FIELD Bit(16) length
    FIELD Bit(128) data
}
INTERFACE AfB(owidth=32,width=144)  {
    FILE adapter_OC_h
    INTERFACE PipeInLast(width=32) in
    INTERFACE/Ptr PipeIn(width=144) out
}
INTERFACE AtB(width=128,owidth=32)  {
    FILE adapter_OC_h
    INTERFACE PipeInLength(width=128) in
    INTERFACE PipeOutLast(width=32) out
}
INTERFACE PipeIn(width=32)  {
    FILE atomicc_OC_h
    METHOD/Action enq__ENA ( Bit(width) v )
}
INTERFACE PipeInLast(width=32)  {
    FILE atomicc_OC_h
    METHOD/Action enq__ENA ( Bit(width) v , Bit(1) last )
}
INTERFACE PipeInLength(width=128)  {
    FILE atomicc_OC_h
    METHOD/Action enq__ENA ( Bit(width) v , Bit(16) size )
}
INTERFACE PipeOutLast(width=32)  {
    FILE atomicc_OC_h
    METHOD/Action deq__ENA
    METHOD first Bit(width)
    METHOD last Bit(1)
}
EMODULE Dummy PipeIn(width=32) {
    FILE atomicc_OC_h
}
MODULE AdapterFromBus(owidth=32,width=144) AfB(owidth=32,width=144) {
    FILE adapter_OC_cpp
    FIELD Bit(128) buffer
    FIELD Bit(1) waitForEnq
    FIELD Bit(16) length
    METHOD/Action in$enq__ENA ( Bit(owidth) v , Bit(1) last ) if (((waitForEnq) ^ (1))) {
        PRINTF ((0) != (0)):printf{"adapterFROMin %x last %x buffer %x\n",in$enq$v,in$enq$last,buffer}
        STORE :buffer = __bitconcat{in$enq$v,__bitsubstr{buffer,(128) - (1),32}}
        STORE :length = (length) + (32)
        STORE (in$enq$last):waitForEnq = 1
    }
    METHOD/Rule/Action RULE$pushValue__ENA if ((waitForEnq)) {
        ALLOCA NOCDataH _RULE$pushValue$agg_2e_tmp
        STORE :length = 0
        PRINTF ((0) != (0)):printf{"adapterFROMout %x\n",buffer}
        LET Bit(16) :_RULE$pushValue$agg_2e_tmp.length = length
        LET Bit(128) :_RULE$pushValue$agg_2e_tmp.data = buffer
        CALL/Action :out$enq__ENA{_RULE$pushValue$agg_2e_tmp}
        STORE :waitForEnq = 0
    }
}
MODULE AdapterToBus(width=128,owidth=32) AtB(width=128,owidth=32) {
    FILE adapter_OC_cpp
    FIELD Bit(128) buffer
    FIELD Bit(16) remain
    METHOD/Action in$enq__ENA ( Bit(width) v , Bit(16) size ) if (((remain) == (0))) {
        STORE :buffer = in$enq$v
        STORE :remain = in$enq$size
        PRINTF ((0) != (0)):printf{"adapterTOin %x length %x\n",in$enq$v,in$enq$size}
    }
    METHOD out$last Bit(1) = (((remain) <= (32))) if (((remain) != (0)))
    METHOD out$first Bit(width) = ((_out$first$outVal)) if (((remain) != (0))) {
        ALLOCA Bit(32) _out$first$outVal
        LET Bit(32) :_out$first$outVal = __bitsubstr{buffer,(128) - (1),(128) - (32)}
    }
    METHOD/Action out$deq__ENA if (((remain) != (0))) {
        PRINTF ((0) != (0)):printf{"adapterTOout remain %x\n",remain}
        STORE ((remain) <= (32)):remain = 0
        STORE !((remain) <= (32)):remain = (remain) - (32)
        STORE :buffer = (buffer) << (32)
    }
}
